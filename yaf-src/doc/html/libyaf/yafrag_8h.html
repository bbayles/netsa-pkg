<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YAF: yafrag.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Tutorials</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_615759f7aa2b23f9d732a2fd184cb668.html">yaf</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">yafrag.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;yaf/autoinc.h&gt;</code><br />
<code>#include &lt;yaf/decode.h&gt;</code><br />
<code>#include &lt;<a class="el" href="yafcore_8h_source.html">yaf/yafcore.h</a>&gt;</code><br />
</div>
<p><a href="yafrag_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a6ef93bd756b0c8af4dc659f47ed1ffa4"><td class="memItemLeft" align="right" valign="top">typedef struct yfFragTab_st&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a></td></tr>
<tr class="memdesc:a6ef93bd756b0c8af4dc659f47ed1ffa4"><td class="mdescLeft">&#160;</td><td class="mdescRight">A fragment table.  <a href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">More...</a><br /></td></tr>
<tr class="separator:a6ef93bd756b0c8af4dc659f47ed1ffa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab90a4b9f15ab1ec55f2cdd16a8747249"><td class="memItemLeft" align="right" valign="top"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#ab90a4b9f15ab1ec55f2cdd16a8747249">yfFragTabAlloc</a> (uint32_t idle_ms, uint32_t max_frags, uint32_t max_payload)</td></tr>
<tr class="memdesc:ab90a4b9f15ab1ec55f2cdd16a8747249"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a fragment table.  <a href="yafrag_8h.html#ab90a4b9f15ab1ec55f2cdd16a8747249">More...</a><br /></td></tr>
<tr class="separator:ab90a4b9f15ab1ec55f2cdd16a8747249"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21beb6d36cdeba13f7c3d90dd9c0b821"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#a21beb6d36cdeba13f7c3d90dd9c0b821">yfFragTabFree</a> (<a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *fragtab)</td></tr>
<tr class="memdesc:a21beb6d36cdeba13f7c3d90dd9c0b821"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a fragment table.  <a href="yafrag_8h.html#a21beb6d36cdeba13f7c3d90dd9c0b821">More...</a><br /></td></tr>
<tr class="separator:a21beb6d36cdeba13f7c3d90dd9c0b821"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf4a0fa912ab55a8d8a4250c072cba16"><td class="memItemLeft" align="right" valign="top">gboolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#acf4a0fa912ab55a8d8a4250c072cba16">yfDefragPBuf</a> (<a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *fragtab, <a class="el" href="structyf_i_p_frag_info__st.html">yfIPFragInfo_t</a> *fraginfo, size_t pbuflen, <a class="el" href="structyf_p_buf__st.html">yfPBuf_t</a> *pbuf, const uint8_t *pkt, size_t hdr_len)</td></tr>
<tr class="memdesc:acf4a0fa912ab55a8d8a4250c072cba16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defragment a fragment returned by yfDecodeToPBuf().  <a href="yafrag_8h.html#acf4a0fa912ab55a8d8a4250c072cba16">More...</a><br /></td></tr>
<tr class="separator:acf4a0fa912ab55a8d8a4250c072cba16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c8a3400f13eee32f74a1c68da42e518"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#a2c8a3400f13eee32f74a1c68da42e518">yfFragDumpStats</a> (<a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *fragtab, uint64_t packetTotal)</td></tr>
<tr class="memdesc:a2c8a3400f13eee32f74a1c68da42e518"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print fragment reassembler statistics to the log.  <a href="yafrag_8h.html#a2c8a3400f13eee32f74a1c68da42e518">More...</a><br /></td></tr>
<tr class="separator:a2c8a3400f13eee32f74a1c68da42e518"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44af4b04de3cfb706b94d0c4935ae885"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="yafrag_8h.html#a44af4b04de3cfb706b94d0c4935ae885">yfGetFragTabStats</a> (<a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *fragtab, uint32_t *dropped, uint32_t *assembled, uint32_t *frags)</td></tr>
<tr class="memdesc:a44af4b04de3cfb706b94d0c4935ae885"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get Frag Stats to yfWriteStatsFlow for Stats Export.  <a href="yafrag_8h.html#a44af4b04de3cfb706b94d0c4935ae885">More...</a><br /></td></tr>
<tr class="separator:a44af4b04de3cfb706b94d0c4935ae885"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Fragment reassembly interface for YAF. </p>
<p >[TODO - new frontmatter]</p>
<p >This facility is used by the YAF flow generator. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a6ef93bd756b0c8af4dc659f47ed1ffa4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ef93bd756b0c8af4dc659f47ed1ffa4">&#9670;&nbsp;</a></span>yfFragTab_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct yfFragTab_st <a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A fragment table. </p>
<p >Opaque. Create with <a class="el" href="yafrag_8h.html#ab90a4b9f15ab1ec55f2cdd16a8747249" title="Allocate a fragment table.">yfFragTabAlloc()</a> and free with <a class="el" href="yafrag_8h.html#a21beb6d36cdeba13f7c3d90dd9c0b821" title="Free a fragment table.">yfFragTabFree()</a>. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="acf4a0fa912ab55a8d8a4250c072cba16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf4a0fa912ab55a8d8a4250c072cba16">&#9670;&nbsp;</a></span>yfDefragPBuf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gboolean yfDefragPBuf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&#160;</td>
          <td class="paramname"><em>fragtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structyf_i_p_frag_info__st.html">yfIPFragInfo_t</a> *&#160;</td>
          <td class="paramname"><em>fraginfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>pbuflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structyf_p_buf__st.html">yfPBuf_t</a> *&#160;</td>
          <td class="paramname"><em>pbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>hdr_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Defragment a fragment returned by yfDecodeToPBuf(). </p>
<p >This adds the fragment to the given fragment table. If the fragment completes a fragmented packet, copies the assembled packet into the given pbuf, overwriting it, and returns TRUE. If the packet is not fragmented (that is, if fraginfo-&gt;frag is 0), has no effect and returns TRUE.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fragtab</td><td>fragment table to add fragment to </td></tr>
    <tr><td class="paramname">fraginfo</td><td>fragment information structure filled in by yfDecodeToPBuf() </td></tr>
    <tr><td class="paramname">pbuflen</td><td>size of the packet buffer pbuf </td></tr>
    <tr><td class="paramname">pbuf</td><td>packet buffer. On call, contains decoded fragmented packet to add to the fragment table. If this call returns TRUE, on return, contains assembled packet. </td></tr>
    <tr><td class="paramname">pkt</td><td>pkt buffer from libpcap. We need this to reassemble (memcpy) TCP header fragments when payload is not enabled. </td></tr>
    <tr><td class="paramname">hdr_len</td><td>size of the packet buffer pkt </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if pbuf is valid and contains an assembled packet, FALSE otherwise. </dd></dl>

</div>
</div>
<a id="a2c8a3400f13eee32f74a1c68da42e518"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c8a3400f13eee32f74a1c68da42e518">&#9670;&nbsp;</a></span>yfFragDumpStats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void yfFragDumpStats </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&#160;</td>
          <td class="paramname"><em>fragtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>packetTotal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print fragment reassembler statistics to the log. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fragtab</td><td>fragment table to dump stats for </td></tr>
    <tr><td class="paramname">packetTotal</td><td>total number of packets observed </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab90a4b9f15ab1ec55f2cdd16a8747249"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab90a4b9f15ab1ec55f2cdd16a8747249">&#9670;&nbsp;</a></span>yfFragTabAlloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> * yfFragTabAlloc </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>idle_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>max_frags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>max_payload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a fragment table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">idle_ms</td><td>idle timeout in milliseconds. A fragmented packet for which no fragments are received over an idle timeout is dropped. Most host IPv4 implementations use 30 seconds (30000); it is recommended to use the same here. </td></tr>
    <tr><td class="paramname">max_frags</td><td>maximum number of unreassembled fragmented packets. Fragmented packets exceeding this limit will be dropped in least-recent order. Used to limit resource usage of a fragment table. A value of 0 disables fragment count limits. </td></tr>
    <tr><td class="paramname">max_payload</td><td>maximum octets of payload to capture per fragmented packet. A value of 0 disables payload reassembly.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a new fragment table. </dd></dl>

</div>
</div>
<a id="a21beb6d36cdeba13f7c3d90dd9c0b821"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21beb6d36cdeba13f7c3d90dd9c0b821">&#9670;&nbsp;</a></span>yfFragTabFree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void yfFragTabFree </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&#160;</td>
          <td class="paramname"><em>fragtab</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a fragment table. </p>
<p >Discards any outstanding fragmented packets within.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fragtab</td><td>a fragment table. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a44af4b04de3cfb706b94d0c4935ae885"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44af4b04de3cfb706b94d0c4935ae885">&#9670;&nbsp;</a></span>yfGetFragTabStats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void yfGetFragTabStats </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="yafrag_8h.html#a6ef93bd756b0c8af4dc659f47ed1ffa4">yfFragTab_t</a> *&#160;</td>
          <td class="paramname"><em>fragtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>dropped</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>assembled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>frags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get Frag Stats to yfWriteStatsFlow for Stats Export. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fragtab</td><td>pointer to fragmentation table </td></tr>
    <tr><td class="paramname">dropped</td><td>number of expired fragments </td></tr>
    <tr><td class="paramname">assembled</td><td>number of assembled packets </td></tr>
    <tr><td class="paramname">frags</td><td>number of fragments </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</body>
</html>
